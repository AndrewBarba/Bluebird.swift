<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Bluebird  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
  </head>
  <body>
    <a title="Bluebird  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html">Bluebird Docs</a> (71% documented)</p>
        <p class="header-right"><a href="https://github.com/AndrewBarba/Bluebird.swift"><img src="img/gh.png"/>View on GitHub</a></p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html">Bluebird Reference</a>
        <img id="carat" src="img/carat.png" />
        Bluebird  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/Promise.html">Promise</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Enums/BluebirdError.html">BluebirdError</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/ReflectionState.html">ReflectionState</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Functions.html">Functions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Functions.html#/s:8Bluebird11VoidPromiseAA0C0CyytGyF">VoidPromise()</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:8Bluebird3allAA7PromiseCySayxGGSo13DispatchQueueC2on_SayADyxGGdtlF">all(on:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:8Bluebird3allAA7PromiseCySayxGGSo13DispatchQueueC2on_q_ts8SequenceR_ADyxG7ElementRt_r0_lF">all(on:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:8Bluebird3anyAA7PromiseCyxGSo13DispatchQueueC2on_SayAEGdtlF">any(on:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:8Bluebird3anyAA7PromiseCyxGSo13DispatchQueueC2on_q_ts8SequenceR_AE7ElementRt_r0_lF">any(on:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:8Bluebird5delayAA7PromiseCyxGSo13DispatchQueueC2on_SdAEtlF">delay(on:_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:8Bluebird5delayAA7PromiseCyxGSo13DispatchQueueC2on_SdxtlF">delay(on:_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:8Bluebird4joinAA7PromiseCyx_q_tGSo13DispatchQueueC2on_ADyxGADyq_Gtr0_lF">join(on:_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:8Bluebird4joinAA7PromiseCyx_q_q0_tGSo13DispatchQueueC2on_ADyxGADyq_GADyq0_Gtr1_lF">join(on:_:_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:8Bluebird4joinAA7PromiseCyx_q_q0_q1_tGSo13DispatchQueueC2on_ADyxGADyq_GADyq0_GADyq1_Gtr2_lF">join(on:_:_:_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:8Bluebird3mapAA7PromiseCySayq_GGSo13DispatchQueueC2on_q0_ADyq_GxKct7ElementQy0_Rszs8SequenceR0_r1_lF">map(on:_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:8Bluebird9mapSeriesAA7PromiseCySayq_GGSo13DispatchQueueC2on_q0_ADyq_GxKct7ElementQy0_Rszs8SequenceR0_r1_lF">mapSeries(on:_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:8Bluebird4raceAA7PromiseCyxGSo13DispatchQueueC2on_SayAEGdtlF">race(on:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:8Bluebird4raceAA7PromiseCyxGSo13DispatchQueueC2on_q_ts8SequenceR_AE7ElementRt_r0_lF">race(on:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:8Bluebird6reduceAA7PromiseCyq_GSo13DispatchQueueC2on_q0_q_AEq__xtKct7ElementQy0_Rszs8SequenceR0_r1_lF">reduce(on:_:_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:8Bluebird3tryAA7PromiseCyxGSo13DispatchQueueC2on_AEyKctlF">try(on:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:8Bluebird3tryAA7PromiseCyxGSo13DispatchQueueC2on_xyKctlF">try(on:_:)</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <h1 id='bluebird-swift' class='heading'>Bluebird.swift</h1>

<p><a href="https://www.bitrise.io/app/701ab7c9f38d6256"><img src="https://www.bitrise.io/app/701ab7c9f38d6256.svg?token=iG7jwI_9wFXyDl886lLAWw&branch=master" alt="Build Status"></a>
<a href="https://img.shields.io/cocoapods/v/Bluebird.svg"><img src="https://img.shields.io/cocoapods/v/Bluebird.svg" alt="CocoaPods Compatible"></a>
<a href="https://github.com/Carthage/Carthage"><img src="https://img.shields.io/badge/Carthage-compatible-4BC51D.svg?style=flat" alt="Carthage Compatible"></a>
<a href="http://twitter.com/andrew_barba"><img src="https://img.shields.io/badge/twitter-@andrew_barba-blue.svg?style=flat" alt="Twitter"></a></p>

<p><a href="https://promisesaplus.com/">Promise/A+</a> compliant, <a href="http://bluebirdjs.com">Bluebird</a> inspired, implementation in Swift 4</p>
<h2 id='features' class='heading'>Features</h2>

<ul>
<li>[x] Promise/A+ Compliant</li>
<li>[x] Swift 4.0</li>
<li>[x] Promise Cancellation</li>
<li>[x] Performance</li>
<li>[x] Lightweight</li>
<li>[x] Unit Tests</li>
<li>[x] 100% Documented</li>
</ul>
<h2 id='documentation' class='heading'>Documentation</h2>

<p><a href="https://andrewbarba.github.io/Bluebird.swift/">https://andrewbarba.github.io/Bluebird.swift/</a></p>
<h2 id='requirements' class='heading'>Requirements</h2>

<ul>
<li>iOS 9.0+ / macOS 10.11+ / tvOS 9.0+ / watchOS 2.0+</li>
<li>Xcode 9.0+</li>
<li>Swift 4.0+</li>
</ul>
<h2 id='installation' class='heading'>Installation</h2>
<h3 id='swift-package-manager' class='heading'>Swift Package Manager</h3>
<pre class="highlight swift"><code><span class="c1">// swift-tools-version:4.0</span>

<span class="kd">import</span> <span class="kt">PackageDescription</span>

<span class="k">let</span> <span class="nv">package</span> <span class="o">=</span> <span class="kt">Package</span><span class="p">(</span>
    <span class="nv">name</span><span class="p">:</span> <span class="s">"My Lisk App"</span><span class="p">,</span>
    <span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span>
        <span class="o">.</span><span class="nf">package</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="s">"https://github.com/AndrewBarba/Bluebird.swift.git"</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="s">"2.4.0"</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>
</code></pre>
<h3 id='cocoapods' class='heading'>CocoaPods</h3>

<blockquote>
<p>CocoaPods 1.1.0+ is required to build Bluebird</p>
</blockquote>
<pre class="highlight ruby"><code><span class="n">pod</span> <span class="s1">'Bluebird'</span><span class="p">,</span> <span class="s1">'~&gt; 2.4'</span>
</code></pre>
<h3 id='carthage' class='heading'>Carthage</h3>
<pre class="highlight plaintext"><code>github "AndrewBarba/Bluebird.swift" ~&gt; 2.4
</code></pre>
<h2 id='who-39-s-using-bluebird' class='heading'>Who&rsquo;s Using Bluebird</h2>

<ul>
<li><a href="https://itunes.apple.com/us/app/barstool-sports/id456805313">Barstool Sports</a></li>
<li><a href="https://itunes.apple.com/us/app/tablelist-a-better-night-out/id634444177">Tablelist − A Better Night Out</a></li>
<li><a href="https://itunes.apple.com/us/app/nightpro-venue-event-management/id1122116578">NightPro − Venue &amp; Event Management</a></li>
<li><a href="https://itunes.apple.com/us/app/everybodyfights-training-camp/id1254458919">EverybodyFights Training Camp</a></li>
</ul>

<blockquote>
<p>Using Bluebird in production? Let me know with a Pull Request or an Issue.</p>
</blockquote>
<h2 id='usage' class='heading'>Usage</h2>

<ul>
<li><a href="#promise">Promise</a></li>
<li><a href="#then">then</a></li>
<li><a href="#catch">catch</a></li>
<li><a href="#tap">tap</a></li>
<li><a href="#finally">finally</a></li>
<li><a href="#join">join</a></li>
<li><a href="#map">map</a></li>
<li><a href="#reduce">reduce</a></li>
<li><a href="#all">all</a></li>
<li><a href="#any">any</a></li>
<li><a href="#try">try</a></li>
</ul>
<h3 id='promise' class='heading'>Promise</h3>

<p>Promises are generic and allow you to specify a type that they will eventually resolve to. The preferred way to create a Promise is to pass in a closure that accepts two functions, one to be called to resolve the Promise and one to be called to reject the Promise:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">promise</span> <span class="o">=</span> <span class="kt">Promise</span><span class="o">&lt;</span><span class="kt">Int</span><span class="o">&gt;</span> <span class="p">{</span> <span class="n">resolve</span><span class="p">,</span> <span class="n">reject</span> <span class="k">in</span>
  <span class="c1">// - resolve(someInt)</span>
  <span class="c1">// - reject(someError)</span>
<span class="p">}</span>
</code></pre>

<p>The <code>resolve</code> and <code>reject</code> functions can be called asynchronously or synchronously. This is a great way to wrap existing Cocoa API to resolve Promises in your own code. For example, look at an expensive function that manipulates an image:</p>
<h6 id='before-promises' class='heading'>Before Promises</h6>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">performExpensiveOperation</span><span class="p">(</span><span class="n">onImage</span> <span class="nv">image</span><span class="p">:</span> <span class="kt">UIImage</span><span class="p">,</span> <span class="nv">completion</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">UIImage</span><span class="p">?,</span> <span class="kt">Error</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">DispatchQueue</span><span class="p">(</span><span class="nv">label</span><span class="p">:</span> <span class="s">"image.operation"</span><span class="p">)</span><span class="o">.</span><span class="n">async</span> <span class="p">{</span>
    <span class="k">do</span> <span class="p">{</span>
      <span class="k">let</span> <span class="nv">image</span> <span class="o">=</span> <span class="k">try</span> <span class="o">...</span>
      <span class="nf">completion</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
      <span class="nf">completion</span><span class="p">(</span><span class="kc">nil</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h6 id='after-promises' class='heading'>After Promises</h6>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">performExpensiveOperation</span><span class="p">(</span><span class="n">onImage</span> <span class="nv">image</span><span class="p">:</span> <span class="kt">UIImage</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Promise</span><span class="o">&lt;</span><span class="kt">UIImage</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kt">Promise</span><span class="o">&lt;</span><span class="kt">UIImage</span><span class="o">&gt;</span> <span class="p">{</span> <span class="n">resolve</span><span class="p">,</span> <span class="n">reject</span> <span class="k">in</span>
    <span class="kt">DispatchQueue</span><span class="p">(</span><span class="nv">label</span><span class="p">:</span> <span class="s">"image.operation"</span><span class="p">)</span><span class="o">.</span><span class="n">async</span> <span class="p">{</span>
      <span class="k">do</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">image</span> <span class="o">=</span> <span class="k">try</span> <span class="o">...</span>
        <span class="nf">resolve</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
      <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
        <span class="nf">reject</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Okay, so the inner body of the function looks almost identical&hellip; But look at how much better the function signature looks!</p>

<p>No more completion handler, no more optional image, no more optional error. Optionals in the original function are a dead giveaway that you&rsquo;ll be guarding and unwrapping in the near future. With the Promise implementation that logic is hidden by good design. Using this new function is now a joy:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">original</span><span class="p">:</span> <span class="kt">UIImage</span> <span class="o">=</span> <span class="o">...</span>

<span class="nf">performExpensiveOperation</span><span class="p">(</span><span class="nv">onImage</span><span class="p">:</span> <span class="n">original</span><span class="p">)</span>
  <span class="o">.</span><span class="n">then</span> <span class="p">{</span> <span class="n">newImage</span> <span class="k">in</span>
    <span class="c1">// do something with the new image</span>
  <span class="p">}</span>
  <span class="o">.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span>
    <span class="c1">// something went wrong, handle the error</span>
  <span class="p">}</span>
</code></pre>
<h3 id='then' class='heading'>then</h3>

<p>You can easily perform a series of operations with the <code>then</code> method:</p>
<pre class="highlight swift"><code><span class="n">authService</span><span class="o">.</span><span class="nf">login</span><span class="p">(</span><span class="nv">email</span><span class="p">:</span> <span class="n">email</span><span class="p">,</span> <span class="nv">password</span><span class="p">:</span> <span class="n">password</span><span class="p">)</span>
  <span class="o">.</span><span class="n">then</span> <span class="p">{</span> <span class="n">auth</span> <span class="k">in</span> <span class="n">userService</span><span class="o">.</span><span class="nf">read</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">auth</span><span class="p">)</span> <span class="p">}</span>
  <span class="o">.</span><span class="n">then</span> <span class="p">{</span> <span class="n">user</span> <span class="k">in</span> <span class="n">favoriteService</span><span class="o">.</span><span class="nf">list</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">user</span><span class="p">)</span> <span class="p">}</span>
  <span class="o">.</span><span class="n">then</span> <span class="p">{</span> <span class="n">favorites</span> <span class="k">in</span> <span class="o">...</span> <span class="p">}</span>
</code></pre>

<p>Notice each time you return a Promise (or a value) from a <code>then</code> handler, the next <code>then</code> handler receives the resolution of that handler, waiting for the previous to fully resolve. This is extremely powerful for asynchronous control flow.</p>
<h4 id='grand-central-dispatch' class='heading'>Grand Central Dispatch</h4>

<p>Any method in <code>Bluebird</code> that accepts a handler also accepts a <code>DispatchQueue</code> so you can control what queue you want the handler to run on:</p>
<pre class="highlight swift"><code><span class="n">userService</span><span class="o">.</span><span class="nf">read</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="s">"123"</span><span class="p">)</span>
  <span class="o">.</span><span class="nf">then</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="n">backgroundQueue</span><span class="p">)</span> <span class="p">{</span> <span class="n">user</span> <span class="o">-&gt;</span> <span class="kt">UIImage</span> <span class="k">in</span>
    <span class="k">let</span> <span class="nv">image</span> <span class="o">=</span> <span class="kt">UIImage</span><span class="p">(</span><span class="nv">user</span><span class="p">:</span> <span class="n">user</span><span class="p">)</span>
    <span class="o">...</span> <span class="n">perform</span> <span class="n">complex</span> <span class="n">image</span> <span class="n">operation</span> <span class="o">...</span>
    <span class="k">return</span> <span class="n">image</span>
  <span class="p">}</span>
  <span class="o">.</span><span class="nf">then</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="o">.</span><span class="n">main</span><span class="p">)</span> <span class="p">{</span> <span class="n">image</span> <span class="k">in</span>
    <span class="k">self</span><span class="o">.</span><span class="n">imageView</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">image</span>
  <span class="p">}</span>
</code></pre>

<p>By default all handlers are run on the <code>.main</code> queue.</p>
<h3 id='catch' class='heading'>catch</h3>

<p>Use <code>catch</code> to handle / recover from errors that happen in a Promise chain:</p>
<pre class="highlight swift"><code><span class="n">authService</span><span class="o">.</span><span class="nf">login</span><span class="p">(</span><span class="nv">email</span><span class="p">:</span> <span class="n">email</span><span class="p">,</span> <span class="nv">password</span><span class="p">:</span> <span class="n">password</span><span class="p">)</span>
  <span class="o">.</span><span class="n">then</span> <span class="p">{</span> <span class="n">auth</span> <span class="k">in</span> <span class="n">userService</span><span class="o">.</span><span class="nf">read</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">auth</span><span class="p">)</span> <span class="p">}</span>
  <span class="o">.</span><span class="n">then</span> <span class="p">{</span> <span class="n">user</span> <span class="k">in</span> <span class="n">favoriteService</span><span class="o">.</span><span class="nf">list</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">user</span><span class="p">)</span> <span class="p">}</span>
  <span class="o">.</span><span class="n">then</span> <span class="p">{</span> <span class="n">favorites</span> <span class="k">in</span> <span class="o">...</span> <span class="p">}</span>
  <span class="o">.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span>
    <span class="k">self</span><span class="o">.</span><span class="nf">present</span><span class="p">(</span><span class="nv">error</span><span class="p">:</span> <span class="n">error</span><span class="p">)</span>
  <span class="p">}</span>
</code></pre>

<p>Above, if any <code>then</code> handler <code>throw</code>s an error, or if one of the Promises returned from a handler rejects, then the final catch handler will be called.</p>

<p>You can also perform complex recovery when running multiple asynchronous operations:</p>
<pre class="highlight swift"><code><span class="kt">Bluebird</span><span class="o">.</span><span class="k">try</span> <span class="p">{</span> <span class="nf">performFirstOp</span><span class="p">()</span><span class="o">.</span><span class="nf">catch</span><span class="p">(</span><span class="n">handleOpError</span><span class="p">)</span> <span class="p">}</span>
  <span class="o">.</span><span class="n">then</span> <span class="p">{</span> <span class="nf">performSecondOp</span><span class="p">()</span><span class="o">.</span><span class="nf">catch</span><span class="p">(</span><span class="n">handleOpError</span><span class="p">)</span> <span class="p">}</span>
  <span class="o">.</span><span class="n">then</span> <span class="p">{</span> <span class="nf">performThirdOp</span><span class="p">()</span><span class="o">.</span><span class="nf">catch</span><span class="p">(</span><span class="n">handleOpError</span><span class="p">)</span> <span class="p">}</span>
  <span class="o">.</span><span class="n">then</span> <span class="p">{</span> <span class="nf">performFourthOp</span><span class="p">()</span><span class="o">.</span><span class="nf">catch</span><span class="p">(</span><span class="n">handleOpError</span><span class="p">)</span> <span class="p">}</span>
  <span class="o">.</span><span class="n">then</span> <span class="p">{</span>
    <span class="c1">// all completed</span>
  <span class="p">}</span>
</code></pre>
<h3 id='tap' class='heading'>tap</h3>

<p>Useful for performing an operation in the middle of a promise chain without changing the type of the Promise:</p>
<pre class="highlight swift"><code><span class="n">authService</span><span class="o">.</span><span class="nf">login</span><span class="p">(</span><span class="nv">email</span><span class="p">:</span> <span class="n">email</span><span class="p">,</span> <span class="nv">password</span><span class="p">:</span> <span class="n">password</span><span class="p">)</span>
  <span class="o">.</span><span class="n">tap</span> <span class="p">{</span> <span class="n">auth</span> <span class="k">in</span> <span class="nf">print</span><span class="p">(</span><span class="n">auth</span><span class="p">)</span> <span class="p">}</span>
  <span class="o">.</span><span class="n">then</span> <span class="p">{</span> <span class="n">auth</span> <span class="k">in</span> <span class="n">userService</span><span class="o">.</span><span class="nf">read</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">auth</span><span class="p">)</span> <span class="p">}</span>
  <span class="o">.</span><span class="n">tap</span> <span class="p">{</span> <span class="n">user</span> <span class="k">in</span> <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="p">)</span> <span class="p">}</span>
  <span class="o">.</span><span class="n">then</span> <span class="p">{</span> <span class="n">user</span> <span class="k">in</span> <span class="n">favoriteService</span><span class="o">.</span><span class="nf">list</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">user</span><span class="p">)</span> <span class="p">}</span>
  <span class="o">.</span><span class="n">then</span> <span class="p">{</span> <span class="n">favorites</span> <span class="k">in</span> <span class="o">...</span> <span class="p">}</span>
</code></pre>

<p>You can also return a Promise from the <code>tap</code> handler and the chain will wait for that promise to resolve:</p>
<pre class="highlight swift"><code><span class="n">authService</span><span class="o">.</span><span class="nf">login</span><span class="p">(</span><span class="nv">email</span><span class="p">:</span> <span class="n">email</span><span class="p">,</span> <span class="nv">password</span><span class="p">:</span> <span class="n">password</span><span class="p">)</span>
  <span class="o">.</span><span class="n">then</span> <span class="p">{</span> <span class="n">auth</span> <span class="k">in</span> <span class="n">userService</span><span class="o">.</span><span class="nf">read</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">auth</span><span class="p">)</span> <span class="p">}</span>
  <span class="o">.</span><span class="n">tap</span> <span class="p">{</span> <span class="n">user</span> <span class="k">in</span> <span class="n">userService</span><span class="o">.</span><span class="nf">updateLastActive</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">user</span><span class="p">)</span> <span class="p">}</span>
  <span class="o">.</span><span class="n">then</span> <span class="p">{</span> <span class="n">user</span> <span class="k">in</span> <span class="n">favoriteService</span><span class="o">.</span><span class="nf">list</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">user</span><span class="p">)</span> <span class="p">}</span>
  <span class="o">.</span><span class="n">then</span> <span class="p">{</span> <span class="n">favorites</span> <span class="k">in</span> <span class="o">...</span> <span class="p">}</span>
</code></pre>
<h3 id='finally' class='heading'>finally</h3>

<p>With <code>finally</code> you can register a handler to run at the end of a Promise chain, regardless of it&rsquo;s result:</p>
<pre class="highlight swift"><code><span class="n">spinner</span><span class="o">.</span><span class="nf">startAnimating</span><span class="p">()</span>

<span class="n">authService</span><span class="o">.</span><span class="nf">login</span><span class="p">(</span><span class="nv">email</span><span class="p">:</span> <span class="n">email</span><span class="p">,</span> <span class="nv">password</span><span class="p">:</span> <span class="s">"bad password"</span><span class="p">)</span>
  <span class="o">.</span><span class="n">then</span> <span class="p">{</span> <span class="n">auth</span> <span class="k">in</span> <span class="n">userService</span><span class="o">.</span><span class="nf">read</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">auth</span><span class="p">)</span> <span class="p">}</span> <span class="c1">// will not run</span>
  <span class="o">.</span><span class="n">then</span> <span class="p">{</span> <span class="n">user</span> <span class="k">in</span> <span class="n">favoriteService</span><span class="o">.</span><span class="nf">list</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">user</span><span class="p">)</span> <span class="p">}</span> <span class="c1">// will not run</span>
  <span class="o">.</span><span class="n">finally</span> <span class="p">{</span> <span class="c1">// this will run!</span>
    <span class="n">spinner</span><span class="o">.</span><span class="nf">stopAnimating</span><span class="p">()</span>
  <span class="p">}</span>
  <span class="o">.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span>
    <span class="c1">// handle error</span>
  <span class="p">}</span>
</code></pre>
<h3 id='join' class='heading'>join</h3>

<p>Join different types of Promises seamlessly:</p>
<pre class="highlight swift"><code><span class="nf">join</span><span class="p">(</span><span class="nf">fetchArticle</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="s">"123"</span><span class="p">),</span> <span class="nf">fetchAuthor</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="s">"456"</span><span class="p">))</span>
  <span class="o">.</span><span class="n">then</span> <span class="p">{</span> <span class="n">article</span><span class="p">,</span> <span class="n">author</span> <span class="k">in</span>
    <span class="c1">// ...</span>
  <span class="p">}</span>
</code></pre>
<h3 id='map' class='heading'>map</h3>

<p>Iterate over a sequence of elements and perform an operation each:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">articles</span> <span class="o">=</span> <span class="o">...</span>

<span class="nf">map</span><span class="p">(</span><span class="n">articles</span><span class="p">)</span> <span class="p">{</span> <span class="n">article</span> <span class="k">in</span>
  <span class="k">return</span> <span class="n">favoriteService</span><span class="o">.</span><span class="nf">like</span><span class="p">(</span><span class="nv">article</span><span class="p">:</span> <span class="n">article</span><span class="p">)</span>
<span class="p">}</span><span class="o">.</span><span class="n">then</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span>
  <span class="c1">// all articles liked successfully</span>
<span class="p">}</span><span class="o">.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span>
  <span class="c1">// handle error</span>
<span class="p">}</span>
</code></pre>

<p>You can also iterate over a sequence in series using <code>mapSeries()</code>.</p>
<h3 id='reduce' class='heading'>reduce</h3>

<p>Iterate over a sequence and reduce down to a Promise that resolves to a single value:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">users</span> <span class="o">=</span> <span class="o">...</span>

<span class="nf">reduce</span><span class="p">(</span><span class="n">users</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="n">partialTime</span><span class="p">,</span> <span class="n">user</span> <span class="k">in</span>
  <span class="k">return</span> <span class="n">userService</span><span class="o">.</span><span class="nf">getActiveTime</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">user</span><span class="p">)</span><span class="o">.</span><span class="n">then</span> <span class="p">{</span> <span class="n">time</span> <span class="k">in</span>
    <span class="k">return</span> <span class="n">partialTime</span> <span class="o">+</span> <span class="n">time</span>
  <span class="p">}</span>
<span class="p">}</span><span class="o">.</span><span class="n">then</span> <span class="p">{</span> <span class="n">totalTime</span> <span class="k">in</span>
  <span class="c1">// calculated total time spent in app</span>
<span class="p">}</span><span class="o">.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span>
  <span class="c1">// handle error</span>
<span class="p">}</span>
</code></pre>
<h3 id='all' class='heading'>all</h3>

<p>Wait for all promises to complete:</p>
<pre class="highlight swift"><code><span class="nf">all</span><span class="p">([</span>
  <span class="n">favoriteService</span><span class="o">.</span><span class="nf">like</span><span class="p">(</span><span class="nv">article</span><span class="p">:</span> <span class="n">article1</span><span class="p">),</span>
  <span class="n">favoriteService</span><span class="o">.</span><span class="nf">like</span><span class="p">(</span><span class="nv">article</span><span class="p">:</span> <span class="n">article2</span><span class="p">),</span>
  <span class="n">favoriteService</span><span class="o">.</span><span class="nf">like</span><span class="p">(</span><span class="nv">article</span><span class="p">:</span> <span class="n">article3</span><span class="p">),</span>
  <span class="n">favoriteService</span><span class="o">.</span><span class="nf">like</span><span class="p">(</span><span class="nv">article</span><span class="p">:</span> <span class="n">article4</span><span class="p">),</span>
<span class="p">])</span><span class="o">.</span><span class="n">then</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span>
  <span class="c1">// all articles liked</span>
<span class="p">}</span>
</code></pre>
<h3 id='any' class='heading'>any</h3>

<p>Easily handle race conditions with <code>any</code>, as soon as one Promise resolves the handler is called and will never be called again:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">host1</span> <span class="o">=</span> <span class="s">"https://east.us.com/file"</span>
<span class="k">let</span> <span class="nv">host2</span> <span class="o">=</span> <span class="s">"https://west.us.com/file"</span>

<span class="nf">any</span><span class="p">(</span><span class="nf">download</span><span class="p">(</span><span class="n">host1</span><span class="p">),</span> <span class="nf">download</span><span class="p">(</span><span class="n">host2</span><span class="p">))</span>
  <span class="o">.</span><span class="n">then</span> <span class="p">{</span> <span class="n">data</span> <span class="k">in</span>
    <span class="o">...</span>
  <span class="p">}</span>
</code></pre>
<h3 id='try' class='heading'>try</h3>

<p>Start off a Promise chain:</p>
<pre class="highlight swift"><code><span class="c1">// Prefix with Bluebird since try is reserved in Swift</span>
<span class="kt">Bluebird</span><span class="o">.</span><span class="k">try</span> <span class="p">{</span>
  <span class="n">authService</span><span class="o">.</span><span class="nf">login</span><span class="p">(</span><span class="nv">email</span><span class="p">:</span> <span class="n">email</span><span class="p">,</span> <span class="nv">password</span><span class="p">:</span> <span class="n">password</span><span class="p">)</span>
<span class="p">}</span><span class="o">.</span><span class="n">then</span> <span class="p">{</span> <span class="n">auth</span> <span class="k">in</span>
  <span class="c1">// handle login</span>
<span class="p">}</span><span class="o">.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span>
  <span class="c1">// handle error</span>
<span class="p">}</span>
</code></pre>
<h2 id='tests' class='heading'>Tests</h2>

<p>Tests are continuously run on <a href="https://www.bitrise.io/">Bitrise</a>. Since Bitrise doesn&rsquo;t support public test runs I can&rsquo;t link to them, but you can run the tests yourself by opening the Xcode project and running the tests manually from the Bluebird scheme.</p>
<h2 id='bluebird-vs-promisekit' class='heading'>Bluebird vs PromiseKit</h2>

<p>I&rsquo;d be lying if I said <a href="https://github.com/mxcl/PromiseKit">PromiseKit</a> wasn&rsquo;t a fantastic library (it is!) but Bluebird has different goals that may or may not appeal to different developers.</p>
<h4 id='xcode-9-swift-4' class='heading'>Xcode 9+ / Swift 4+</h4>

<p>PromiseKit goes to great length to maintain compatibility with Objective-C, previous versions of Swift, and previous versions of Xcode. Thats a ton of work, god bless them.</p>
<h4 id='generics-amp-composition' class='heading'>Generics &amp; Composition</h4>

<p>Bluebird has a more sophisticated use of generics throughout the library giving us really nice API for composing Promise chains in Swift.</p>

<p>Bluebird supports <code>map</code>, <code>reduce</code>, <code>all</code>, <code>any</code> with any Sequence type, not just arrays. For example, you could use <a href="https://realm.io/docs/swift/latest/">Realm&rsquo;s</a> <code>List</code> or <code>Result</code> types in all of those functions, you can&rsquo;t do this with PromiseKit.</p>

<p>Bluebird also supports <code>Promise.map</code> and <code>Promise.reduce</code> (same as Bluebird.js) which act just like their global equivalent, but can be chained inline on an existing Promise, greatly enhancing Promise composition.</p>
<h4 id='no-extensions' class='heading'>No Extensions</h4>

<p>PromiseKit provides many useful framework extensions that wrap core Cocoa API&rsquo;s in Promise style functions. I currently have no plans to provide such functionality, but if I did, it would be in a different repository so I can keep this one lean and well tested.</p>
<h4 id='bluebird-api-compatible' class='heading'>Bluebird API Compatible</h4>

<p>I began using PromiseKit after heavily using Bluebird.js in my Node/JavaScript projects but became annoyed with the subtle API differences and a few things missing all together. Bluebird.swift attempts to closely follow the API of Bluebird.js:</p>
<h6 id='bluebird-js' class='heading'>Bluebird.js</h6>
<pre class="highlight javascript"><code><span class="nx">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span>
<span class="nx">Promise</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span>
<span class="nx">promise</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">handler</span><span class="p">)</span>
<span class="nx">promise</span><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">handler</span><span class="p">)</span>
<span class="nx">promise</span><span class="p">.</span><span class="k">finally</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">...)</span>
<span class="nx">promise</span><span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="nx">value</span> <span class="o">=&gt;</span> <span class="p">...)</span>
</code></pre>
<h6 id='bluebird-swift' class='heading'>Bluebird.swift</h6>
<pre class="highlight swift"><code><span class="kt">Promise</span><span class="p">(</span><span class="nv">resolve</span><span class="p">:</span> <span class="n">result</span><span class="p">)</span>
<span class="kt">Promise</span><span class="p">(</span><span class="nv">reject</span><span class="p">:</span> <span class="n">error</span><span class="p">)</span>
<span class="n">promise</span><span class="o">.</span><span class="nf">then</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
<span class="n">promise</span><span class="o">.</span><span class="nf">catch</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
<span class="n">promise</span><span class="o">.</span><span class="n">finally</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
<span class="n">promise</span><span class="o">.</span><span class="n">tap</span> <span class="p">{</span> <span class="n">value</span> <span class="k">in</span> <span class="o">...</span> <span class="p">}</span>
</code></pre>
<h6 id='promisekit' class='heading'>PromiseKit</h6>
<pre class="highlight swift"><code><span class="kt">Promise</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">result</span><span class="p">)</span>
<span class="kt">Promise</span><span class="p">(</span><span class="nv">error</span><span class="p">:</span> <span class="n">error</span><span class="p">)</span>
<span class="n">promise</span><span class="o">.</span><span class="nf">then</span><span class="p">(</span><span class="nv">execute</span><span class="p">:</span> <span class="n">handler</span><span class="p">)</span>
<span class="n">promise</span><span class="o">.</span><span class="nf">catch</span><span class="p">(</span><span class="nv">execute</span><span class="p">:</span> <span class="n">handler</span><span class="p">)</span>
<span class="n">promise</span><span class="o">.</span><span class="n">always</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
<span class="n">promise</span><span class="o">.</span><span class="n">tap</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
  <span class="k">switch</span> <span class="n">result</span> <span class="p">{</span>
  <span class="k">case</span> <span class="o">.</span><span class="nf">fullfilled</span><span class="p">(</span><span class="k">let</span> <span class="nv">value</span><span class="p">):</span>
    <span class="o">...</span>
  <span class="k">case</span> <span class="o">.</span><span class="nf">rejected</span><span class="p">(</span><span class="k">let</span> <span class="nv">error</span><span class="p">):</span>
    <span class="o">...</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>These are just a few of the differences, and Bluebird.swift is certainly missing features in Bluebird.js, but my goal is to close that gap and keep maintaining an API that much more closely matches where applicable.</p>

          </section>
        </section>
        <section id="footer">
          <p>&copy; 2018 <a class="link" href="https://abarba.me" target="_blank" rel="external">Andrew Barba</a>. All rights reserved. (Last updated: 2018-03-16)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.9.1</a>, a <a class="link" href="http://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
